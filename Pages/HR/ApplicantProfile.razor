@layout EmptyLayout
@page "/profile"
@using XebecPortal.UI.Services.Models
@using XebecPortal.UI.Service_Interfaces

@inject IEducationDataService _educationDataService
@inject IWorkHistoryDataService _workHistoryDataService
@inject IPersonalInformationDataService _personalInformationDataService
@inject IAdditionalInformationDataService _additionalInformationDataService


<style>
    .this-wrap{
        max-height: 100%!important;
        max-width: 100% !important;
    }
    .nav-tab{
        display: flex;
        align-items: flex-end;
        justify-content: space-between;
        max-width: 100% !important;
        width: 100% !important;
        border-bottom: solid 1px slategrey;
    }
    .this-personal-detail{
        font-size: 3vh;
        font-weight: 600;
        align-items: flex-end;
    }
    .this-nav{
            width: 80%;
            height: 5vh;
            overflow: hidden;
            border: none;
        }
        .this-nav > li{
            height: 100%;
        }
        .this-nav .active{
            height: 100%;
        }
    .this-content{
        padding: 5px;
    }
    .person-info{
       
    }
    .work-history-section { 
      height: 100% !important;
      width: 100% !important;
      display: grid !important; 
      grid-auto-columns: 1fr; 
      grid-auto-rows: 1fr; 
      grid-template-columns: repeat(2, 1fr); 
      grid-gap: 10px;
      padding: 10px;
      overflow-y: auto;
    }
    .work-card:nth-child(4n + 0), .work-card:nth-child(4n + 1){
         background: rgba(239,239,239,0.51);
    }
     .work-card {
            border: solid 1px #fff;
            box-shadow: rgba(0, 0, 0, 0.35) 0 5px 15px;
            border-radius: 10px;
            height: 15vh;
            padding: 10px 10px 0 10px;
            display: grid!important;
            grid-template-columns: 1fr 1fr 1.5fr;
            grid-template-rows: repeat(2, 1fr);
           
        }
        .work-card > *{
            text-overflow: ellipsis;
            overflow-y: auto; 
        }
    
    .work-description { grid-area: 2 / 1 / 3 / 4; }
    
    .company-name { grid-area: 1 / 1 / 2 / 2; }
    
    .job-position { grid-area: 1 / 2 / 2 / 3; }
    
    .start-end-date { grid-area: 1 / 3 / 2 / 4; }

</style>
<div class="container-fluid this-wrap">
    <!--Navigation Tab-->
    <div class="nav-tab">
        <span class="this-personal-detail">Personl Details</span>
        <ul class="nav this-nav nav-tabs" role="tablist">
            <li class="nav-item p-1">
                <a class="nav-link nav-link1 active" data-bs-toggle="tab" href="#personal-information">Personal Information</a>
            </li>
            <li class="nav-item p-1">
                <a class="nav-link nav-link1" data-bs-toggle="tab" href="#work-history">Work History</a>
            </li>
            <li class="nav-item p-1">
                <a class="nav-link nav-link1" data-bs-toggle="tab" href="#education">Education</a>
            </li>
            <li class="nav-item p-1">
                <a class="nav-link nav-link1" data-bs-toggle="tab" href="#online-profile">Online Profile</a>
            </li>
        </ul>
    </div>
    <!--Content Panel-->
    <div class="col-12 this-content">
        <div class="tab-content">
            <!--Personal Information-->
            <div id="personal-information" class="tab-pane active person-info rounded">
                @if (_PersonalInformation != null)
                {
                    <div class="" style="height: 100%;">
                            <div class="row p-3">
                                <div class="col-4">
                                    <label class="form-label" for="first-name">First Name</label>
                                    <p id="first-name" class="form-control name">@_PersonalInformation.FirstName</p>
                                </div>
                                <div class="col-4">
                                    <label class="form-label" for="last-name">Last Name</label>
                                    <p id="last-name" class="form-control name">@_PersonalInformation.LastName</p>
                                </div>
                                <div class="col-4">
                                    <label class="form-label" for="email-address">Email Address</label>
                                    <p id="email-address" class="form-control">@_PersonalInformation.Email</p>
                                </div>
                            </div>
                            <div class="row p-3">
                                <div class="col-4">
                                    <label class="form-label" for="phone-number">Phone Number</label>
                                    <p id="phone-number" class="form-control">@_PersonalInformation.PhoneNumber</p>
                                </div>
                                @if (_AdditionalInformation != null)
                                {
                                    <div class="col-4">
                                        <label class="form-label" for="ethnicity">Ethnicity</label>
                                        <p id="ethnicity" class="form-control">@_AdditionalInformation.Ethnicity</p>
                                    </div>
                                    <div class="col-4">
                                        <label class="form-label" for="gender">Gender</label>
                                        <p id="gender" class="form-control">@_AdditionalInformation.Gender</p>
                                    </div>
                                }
                            </div>
                            <div class="row p-3">
                                <div class="col-4">
                                    <label class="form-label" for="id-number">ID Number</label>
                                    <p id="id-number" class="form-control">@_PersonalInformation.IdNumber</p>
                                </div>
                                <div class="col-8">
                                    <label class="form-label" for="address">Address</label>
                                    <p id="address" class="form-control" rows="4">@_PersonalInformation.Address </p>
                                </div>
                            </div>
                        </div>
                    
                }
                else
                {
                    <div>Getting Personal Information</div>
                }
            </div>
            <!--Work History-->
            <div id="work-history" class="tab-pane">
                <div class="work-history-section">
                    @if (_WorkHistories != null)
                    {
                        foreach (var workHistory in _WorkHistories)
                        {
                            <div class="work-card">
                                <div class="company-name">@workHistory.CompanyName</div>
                                <div class="job-position">@workHistory.JobTitle</div>
                                <div class="start-end-date"><small>@($"{workHistory.StartDate:yyyy MMMM} - {workHistory.EndDate:yyyy MMMM}")</small></div>
                                <div class="work-description">@workHistory.Description</div>
                            </div>
                        }
                    }
                    else
                    {
                        <p>Getting Work history...</p>
                    }
                </div>
            </div>


            <!--Education-->
            <div id="education" class="tab-pane">
                <div class="work-history-section">
                    @if (_Educations != null)
                    {
                        foreach (var education in _Educations)
                        {
                            <div class="work-card">
                            <div class="company-name">@education.Qualification</div>
                            <div class="job-position"></div>
                            <div class="start-end-date"><small>@($"{education.StartDate:yyyy MMMM} - {education.EndDate:yyyy MMMM}")</small></div>
                            <div class="work-description">@education.Insitution</div>
                        </div>
                        }
                    }
                    else
                    {
                        <p>Getting Education history...</p>
                    }
                    
                </div>
            </div>
            <!--Online Profile-->
            <div id="online-profile" class="container tab-pane">
                <h3>Online Profile</h3>
            </div>
        </div>
    </div>
</div>

@code {

    [Parameter]
    public Applicant Applicant { get; set; }

    [Parameter]
    public AppUser AppUser { get; set; }

    public int AppUserId { get; set; }

    private PersonalInformation _PersonalInformation { get; set; }
    private AdditionalInformation _AdditionalInformation { get; set; }
    private List<WorkHistory> _WorkHistories { get; set; }
    private List<Education> _Educations { get; set; }

    protected override async Task OnParametersSetAsync()
    {
        if (Applicant != null)
        {
            AppUserId = Applicant.Id;
            if (AppUserId >= 0)
            {
                AppUserId = 1;
            }
            Console.WriteLine("Getting personal info");
            _PersonalInformation = (await _personalInformationDataService.GetPersonalDetails(AppUserId));
            _WorkHistories = await _workHistoryDataService.GetWorkHistories(AppUserId);
            _Educations = await _educationDataService.GetEducations(AppUserId);
            _AdditionalInformation = await _additionalInformationDataService.GetAdditionalInfo(AppUserId);
        }
    }



}