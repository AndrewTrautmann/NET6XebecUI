@inject HrJobState hrJobState
@inject HttpClient httpClient


<style>
    .phase-manager-container {
        width: 100%;
        height: 90%;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .page-top-select-job {
        height: 5vh;
        width: 100%;
        margin-bottom: 2.5vh;
    }

    .phase-container {
        width: 190px;
        max-height: 75%;
        background-color: white;
        border-radius: 20px;
        overflow-y: auto;
        overflow-x: hidden;
        display: flex;
        justify-content: center;
    }

    .phase-title {
        background-color: #00BCAE;
        text-align: center;
        height: 30px;
        width: 100%;
        margin-bottom: 5px;
    }

    .jobs-container {
        display: flex;
        justify-content: space-evenly;
        width: 90%;
    }

    .job-status {
        display: flex;
        flex-direction: column;
        width: 100%;
        background-color: white;
        height: 400px;
        max-height: 400px;
    }

        .job-status ul {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            display: block;
            justify-content: center;
            margin-left: 8%;
        }

    .no-drop {
        border: 2px dashed red;
    }

    .can-drop {
        border: 2px dashed green;
    }

    .draggable {
        margin-bottom: 5px;
        border: 1px solid #424d5c;
        cursor: grab;
        background: lightgrey;
        color: black;
        border-radius: 8px;
        width: 160px;
        height: 65px;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .draggable-edit {
        width: 15%;

        height: 100%;
        border-radius: 8px;
        display: flex;
        justify-content: center;
    }

    .draggable-content {
        width: 65%;

        height: 100%;
        border-radius: 8px;
        font-family: opensans-light;
        display: flex;
        align-items: center;
        word-wrap: break-word;
    }

    .draggable-picture {
        width: 20%;

        height: 100%;
        border-radius: 8px;
        display: flex;
        justify-content: center;
        align-items: center;
    }

        .draggable:active {
            cursor: grabbing;
            background-color: #d35bc9;
        }


    .drag-item-text {
        font-family: opensans-light;
        margin-left: 5px;
    }

    .mydialog {
        width: 350px;
        height: 400px;
        background-color: white;
        border-radius: 12px;
    }

    .mydialog-title {
        height: 10%;
        width: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 15px;
        font-family: opensans-bold;
        color: black;
    }

    .screening-dialog-body {
        height: 40%;
        width: 100%;
        display: flex;
        justify-content: space-evenly;
        align-items: center;
    }

    .screening-dialog-textarea {
        width: 100%;
        height: 40%;
        display: flex;
        justify-content: space-evenly;
        align-items: center;
    }

    .screening-dialog-email {
        height: 10%;
        width: 90%;
        margin-left: 5%;
        display: flex;
        justify-content: space-evenly;
        align-items: center;
    }

    .email-button{
        position: absolute;
        top: 90%;
        left: 65%;
    }


    .mycard {
        width: 100px;
        height: 100px;
        display: flex;
        justify-content: center;
        align-items: center;
        background-color: white;
        font-family: opensans-bold;
        text-align: center;
        border: 1px solid rgba(255, 255, 255, 0.20);
        border-radius: 12px;
        background: linear-gradient(-45deg, rgba(0,0,0,0.22), rgba(255,255,255,0.25));
        box-shadow: 12px 12px 16px 0 rgba(0, 0, 0, 0.25), -8px -8px 12px 0 rgba(255, 255, 255, 0.3);
    }

    .edit-icon {
        color: #00BCAE;
        font-size: 1em;
        text-align: center;
    }

        .edit-icon:hover {
            color: #d35bc9;
        }

    .currentphase {
        background: linear-gradient(135deg, rgba(211,91,201,0.7), rgba(255,255,255,0.25));
    }

    .active-phase {
        color: white;
        font-weight: bold;
        font-family: opensans-bold;
    }

    .disabled-card{
        color: lightgrey;
        background-color: darkgrey;
    }
    .phase-manager-textarea {
        border-radius: 5px;
        border: 1px solid grey;
        background-color: white;
        width: 300px;
        height: 150px;
        padding: 5px;
    }

    .profile-picture{
        border-radius: 50%;
        width: 30px;
        height: 30px;
        border: 1px solid black;
    }
</style>


<div class="page-top-select-job">
    <div class="hr-job-search-bar">
        <input class="hr-job-search-bar-input" type="text" placeholder="Search" @bind-value="searchTerm" @bind-value:event="oninput" />
    </div>
</div>
<div class="phase-manager-container">

    <div class="jobs-container">

        <div class="phase-container shadow @AppliedDropClass">
            <div class="job-status">
                <div class="phase-title">
                    <h5 class="active-phase">Applied</h5>
                </div>

                <ul class="dropzone"
                    ondragover="event.preventDefault();"
                    ondragstart="event.dataTransfer.setData('', event.target.id);"
                    @ondrop='() => HandleDrop(1)'
                    @ondragenter='() => HandleDragEnter(1)'
                    @ondragleave="HandleDragLeave">

                    @foreach (var item in FilteredItems)
                    {
                        @if (item.ApplicationPhaseId == 1)
                        {
                            <li class="draggable" draggable="true" title="@item.Name" @ondragstart="@(() => HandleDragStart(item))">
                                <div class="draggable-picture">
                                    <img class="profile-picture" src="@item.Picture" />
                                </div>
                                <div class="draggable-content">
                                    <p class="drag-item-text" style="margin-top: 10px;">@item.Name @item.Surname</p>
                                </div>
                                <div class="draggable-edit">
                                </div>
                            </li>
                        }
                    }

                </ul>
            </div>
        </div>

        <div class="phase-container shadow @ScreeningDropClass">
            <div class="job-status">
                <div class="phase-title"> 
                    <h5 class="active-phase">Screening</h5>
                </div>
               

                <ul class="dropzone"
                    ondragover="event.preventDefault();"
                    ondragstart="event.dataTransfer.setData('', event.target.id);"
                    @ondrop='() => HandleDrop(10)'
                    @ondragenter='() => HandleDragEnter(10)'
                    @ondragleave="HandleDragLeave">

                    @foreach (var item in FilteredItems)
                    {
                        @if (item.ApplicationPhaseId is 3 or 5 or 25 or 10)
                        {
                            <li class="draggable" draggable="true" title="@item.Name" @ondragstart="@(() => HandleDragStart(item))">
                                <div class="draggable-picture">
                                    <img class="profile-picture" src="@item.Picture" />
                                </div>
                                <div class="draggable-content">
                                    <p class="drag-item-text" style="margin-top: 10px;">@item.Name @item.Surname</p>
                                </div>
                                <div class="draggable-edit">
                                    <span @onclick='() => ShowDialog(item)'>
                                        <i class="fas fa-edit edit-icon"></i>
                                    </span>
                                </div>
                            </li>
                        }
                    }

                </ul>
            </div>
        </div>

        <div class="phase-container shadow @AssessmentDropClass">
            <div class="job-status">
                <div class="phase-title">
                    <h5 class="active-phase">Assessment</h5>
                </div>
                

                <ul class="dropzone"
                    ondragover="event.preventDefault();"
                    ondragstart="event.dataTransfer.setData('', event.target.id);"
                    @ondrop='() => HandleDrop(27)'
                    @ondragenter='() => HandleDragEnter(27)'
                    @ondragleave="HandleDragLeave">

                    @foreach (var item in FilteredItems)
                    {
                        @if (item.ApplicationPhaseId == 27)
                        {
                            <li class="draggable" draggable="true" title="@item.Name" @ondragstart="@(() => HandleDragStart(item))">
                                <div class="draggable-picture">
                                    <img class="profile-picture" src="@item.Picture" />
                                </div>
                                <div class="draggable-content">
                                    <p class="drag-item-text" style="margin-top: 10px;">@item.Name @item.Surname</p>
                                </div>
                                <div class="draggable-edit">
                                    <span @onclick='() => ShowDialog(item)'>
                                        <i class="fas fa-edit edit-icon"></i>
                                    </span>
                                </div>
                            </li>
                        }
                    }

                </ul>
            </div>
        </div>

        <div class="phase-container shadow @InterviewDropClass">
            <div class="job-status">
                <div class="phase-title">
                    <h5 class="active-phase">Interview</h5>
                </div>

                <ul class="dropzone"
                    ondragover="event.preventDefault();"
                    ondragstart="event.dataTransfer.setData('', event.target.id);"
                    @ondrop='() => HandleDrop(11)'
                    @ondragenter='() => HandleDragEnter(11)'
                    @ondragleave="HandleDragLeave">

                    @foreach (var item in FilteredItems)
                    {
                        @if (item.ApplicationPhaseId is 26 or 28 or 29 or 30 or 31 or 11)
                        {
                            <li class="draggable" draggable="true" title="@item.Name" @ondragstart="@(() => HandleDragStart(item))">
                                <div class="draggable-picture">
                                    <img class="profile-picture" src="@item.Picture" />
                                </div>
                                <div class="draggable-content">
                                    <p class="drag-item-text" style="margin-top: 10px;">@item.Name @item.Surname</p>
                                </div>
                                <div class="draggable-edit">
                                    <span @onclick='() => ShowDialog(item)'>
                                        <i class="fas fa-edit edit-icon"></i>
                                    </span>
                                </div>
                            </li>
                        }
                    }

                </ul>
            </div>
        </div>

        <div class="phase-container shadow @ReferenceDropClass">
            <div class="job-status">
                <div class="phase-title">
                    <h5 class="active-phase">Reference Check</h5>
                </div>
                

                <ul class="dropzone"
                    ondragover="event.preventDefault();"
                    ondragstart="event.dataTransfer.setData('', event.target.id);"
                    @ondrop='() => HandleDrop(32)'
                    @ondragenter='() => HandleDragEnter(32)'
                    @ondragleave="HandleDragLeave">

                    @foreach (var item in FilteredItems)
                    {
                        @if (item.ApplicationPhaseId == 32)
                        {
                            <li class="draggable" draggable="true" title="@item.Name" @ondragstart="@(() => HandleDragStart(item))">
                                <div class="draggable-picture">
                                    <img class="profile-picture" src="@item.Picture" />
                                </div>
                                <div class="draggable-content">
                                    <p class="drag-item-text" style="margin-top: 10px;">@item.Name @item.Surname</p>
                                </div>
                                <div class="draggable-edit">
                                    <span @onclick='() => ShowDialog(item)'>
                                        <i class="fas fa-edit edit-icon"></i>
                                    </span>
                                </div>
                            </li>
                        }
                    }

                </ul>
            </div>
        </div>

        <div class="phase-container shadow @OfferDropClass">
            <div class="job-status">
                <div class="phase-title">
                    <h5 class="active-phase">Offer</h5>
                </div>
                

                <ul class="dropzone"
                    ondragover="event.preventDefault();"
                    ondragstart="event.dataTransfer.setData('', event.target.id);"
                    @ondrop='() => HandleDrop(12)'
                    @ondragenter='() => HandleDragEnter(12)'
                    @ondragleave="HandleDragLeave">

                    @foreach (var item in FilteredItems)
                    {
                        @if (item.ApplicationPhaseId is 33 or 34 or 35 or 12)
                        {
                            <li class="draggable" draggable="true" title="@item.Name" @ondragstart="@(() => HandleDragStart(item))">
                                <div class="draggable-picture">
                                    <img class="profile-picture" src="@item.Picture" />
                                </div>
                                <div class="draggable-content">
                                    <p class="drag-item-text" style="margin-top: 10px;">@item.Name @item.Surname</p>
                                </div>
                                <div class="draggable-edit">
                                    <span @onclick='() => ShowDialog(item)'>
                                        <i class="fas fa-edit edit-icon"></i>
                                    </span>
                                </div>
                            </li>
                        }
                    }

                </ul>
            </div>
        </div>

        <div class="phase-container shadow @SuccessDropClass">
            <div class="job-status">
                <div class="phase-title">
                    <h5 class="active-phase">Hired/Not Hired</h5>
                </div>
                

                <ul class="dropzone"
                    ondragover="event.preventDefault();"
                    ondragstart="event.dataTransfer.setData('', event.target.id);"
                    @ondrop='() => HandleDrop(13)'
                    @ondragenter='() => HandleDragEnter(13)'
                    @ondragleave="HandleDragLeave">

                    @foreach (var item in FilteredItems)
                    {
                        @if (item.ApplicationPhaseId is 36 or 13)
                        {
                            <li class="draggable" draggable="true" title="@item.Name" @ondragstart="@(() => HandleDragStart(item))">
                                <div class="draggable-picture">
                                    <img class="profile-picture" src="@item.Picture" />
                                </div>
                                <div class="draggable-content">
                                    <p class="drag-item-text" style="margin-top: 10px;">@item.Name @item.Surname</p>
                                </div>
                                <div class="draggable-edit">
                                    <span @onclick='() => ShowDialog(item)'>
                                        <i class="fas fa-edit edit-icon"></i>
                                    </span>
                                </div>
                            </li>
                        }
                    }

                </ul>
            </div>
        </div>
    </div>


    <MatDialog @bind-IsOpen="@ScreeningDialogIsOpen">
        <div class="mydialog">
            <div class="mydialog-title">
                <b>Screening</b>
            </div>
            <div class="screening-dialog-body">
                <div class=" rounded shadow mycard @ScreeningOne" @onclick="() => MovePhase(3)"><b>Schedule Phone Screen</b></div>
                <div class=" rounded shadow mycard @ScreeningTwo" @onclick="() => MovePhase(5)"><b>Phone Screened</b></div>
                <div class=" rounded shadow mycard @ScreeningThree" @onclick="() => MovePhase(25)"><b>MS Teams Meeting</b></div>
            </div>
            <div class="screening-dialog-email" style="font-family: opensans-light">
                Send to:
                <input type="text" style="width: 60%;" value="@CurrentEmailRecipient" />
                <span @onclick="SendEmail">
                    <i class="fas fa-paper-plane edit-icon"></i>
                </span>
            </div>
            <div class="screening-dialog-textarea">
                <textarea class="phase-manager-textarea" value="@CurrentEmailTemplate"></textarea>
            </div>
        </div>
    </MatDialog>

    <MatDialog @bind-IsOpen="@AssessmentDialogIsOpen">
        <div class="mydialog">
            <div class="mydialog-title">
                <b>Assessment</b>
            </div>
            <div class="screening-dialog-body">
                <p style="font-size: 40px;">88</p>
            </div>
            <div class="screening-dialog-email" style="font-family: opensans-light">
                Send to:
                <input type="text" style="width: 60%;" value="@CurrentEmailRecipient" />
                <span @onclick="SendEmail">
                    <i class="fas fa-paper-plane edit-icon"></i>
                </span>
            </div>
            <div class="screening-dialog-textarea">
                <textarea class="phase-manager-textarea" value="@CurrentEmailTemplate"></textarea>
            </div>
        </div>
    </MatDialog>

    <MatDialog @bind-IsOpen="@InterviewDialogIsOpen">
        <div class="mydialog">
            <div class="mydialog-title">
                <b>Interview</b>
            </div>
            <div class="screening-dialog-body">
                <div class=" rounded shadow mycard @InterviewOne" @onclick="() => MovePhase(26)"><b>First Round</b></div>
                <div class=" rounded shadow mycard @InterviewTwo" @onclick="() => MovePhase(28)"><b>Second Round</b></div>
                <div class=" rounded shadow mycard @InterviewThree" @onclick="() => MovePhase(29)"><b>Manager Feedback</b></div>
                <div class=" rounded shadow mycard @InterviewFour" @onclick="() => MovePhase(30)"><b>CTO/MD</b></div>
                <div class=" rounded shadow mycard @InterviewFive" @onclick="() => MovePhase(31)"><b>CEO</b></div>
            </div>
            <div class="screening-dialog-email" style="font-family: opensans-light">
                Send to:
                <input type="text" style="width: 60%;" value="@CurrentEmailRecipient" />
                <span @onclick="SendEmail">
                    <i class="fas fa-paper-plane edit-icon"></i>
                </span>
            </div>
            <div class="screening-dialog-textarea">
                <textarea class="phase-manager-textarea" value="@CurrentEmailTemplate"></textarea>
            </div>
        </div>
    </MatDialog>

    <MatDialog @bind-IsOpen="@ReferenceCheckDialogIsOpen">
        <div class="mydialog">
            <div class="mydialog-title">
                <b>Reference Check</b>
            </div>
            <div class="screening-dialog-body">

            </div>
            <div class="screening-dialog-email" style="font-family: opensans-light">
                Send to:
                <input type="text" style="width: 60%;" value="@CurrentEmailRecipient" />
                <span @onclick="SendEmail">
                    <i class="fas fa-paper-plane edit-icon"></i>
                </span>
            </div>
            <div class="screening-dialog-textarea">
                <textarea class="phase-manager-textarea" value="@CurrentEmailTemplate"></textarea>
            </div>
        </div>
    </MatDialog>

    <MatDialog @bind-IsOpen="@OfferDialogIsOpen">
        <div class="mydialog">
            <div class="mydialog-title">
                <b>Offer</b>
            </div>
            <div class="screening-dialog-body">
                <div class=" rounded shadow mycard @OfferOne" @onclick="() => MovePhase(33)"><b>Send Offer</b></div>
                <div class=" rounded shadow mycard @OfferTwo" @onclick="() => MovePhase(34)"><b>Unsuccessful</b></div>
                <div class=" rounded shadow mycard @OfferThree" @onclick="() => MovePhase(35)"><b>Reviewed</b></div>
            </div>
            <div class="screening-dialog-email" style="font-family: opensans-light">
                Send to:
                <input type="text" style="width: 60%;" value="@CurrentEmailRecipient" />
                <span @onclick="SendEmail">
                    <i class="fas fa-paper-plane edit-icon"></i>
                </span>
            </div>
            <div class="screening-dialog-textarea">
                <textarea class="phase-manager-textarea" value="@CurrentEmailTemplate"></textarea>
            </div>
        </div>
    </MatDialog>

    <MatDialog @bind-IsOpen="@HiredDialogIsOpen">
        <div class="mydialog">
            <div class="mydialog-title">
                <b>Successful/Unsuccessful</b>
            </div>
            <div class="screening-dialog-body">
                <div class=" rounded shadow mycard @Hired" @onclick="() => MovePhase(36)"><b>Hired</b></div>
                <div class=" rounded shadow mycard @NotHired" @onclick="Deny"><b>Not Hired</b></div>
            </div>
            <div class="screening-dialog-email" style="font-family: opensans-light">
                Send to: 
                <input type="text" style="width: 60%;" value="@CurrentEmailRecipient"/>
                <span @onclick="SendEmail">
                    <i class="fas fa-paper-plane edit-icon"></i>
                </span>
            </div>
            <div class="screening-dialog-textarea">
                <textarea class="phase-manager-textarea" value="@CurrentEmailTemplate"></textarea>
            </div>
        </div>
    </MatDialog>

    <MatDialog @bind-IsOpen="@ReasonDialogIsOpen" Style="left: 30%;">
        <div class="mydialog" style="height: 170px;">
            <div class="mydialog-title">
                <b>Reasoning</b>
            </div>
            <div class="screening-dialog-body">
                <select @bind="tempReasonId" class="form-select" style="width: 80%;">
                    @foreach (var reason in Unsuccessful)
                    {
                        <option value="@reason.Id" selected>@reason.Reason</option>
                    }
                </select>
            </div>
            <div class="d-flex justify-content-center align-items-center">
                <button class="btn" style="background-color: white; border: 1px solid black" @onclick="Reject">Submit</button>
            </div>
        </div>
    </MatDialog>

</div>



@code {

    [Parameter] public int CurrentJobId { get; set; }

    public ApplicationPhaseItem CurrentItem;

    public string searchTerm = "";
    public int tempReasonId = -1;
    public string CurrentJobTitle = "";
    public string CurrentEmailRecipient = "";
    public string CurrentEmailTemplate = "";

    public int[] AllowedPhasesFinal = new int[] { 1, 3, 5, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 10, 11, 12, 13 };

    List<int> TotalPhases = new List<int>();

    //tables we need
    List<ApplicationPhase> AppPhases = new List<ApplicationPhase>();
    List<ApplicationPhasesHelper> CurrentApplicantPhases = new List<ApplicationPhasesHelper>();
    List<AppUser> tempAppUsers = new List<AppUser>();
    List<UnsuccessfulReason> Unsuccessful = new List<UnsuccessfulReason>();
    List<RejectedCandidate> RejectedUsers = new List<RejectedCandidate>();

    //tables to be filtered
    List<Job> AllJobs = new List<Job>();
    List<Application> AllApplications = new List<Application>();
    List<JobApplicationPhase> AllJobApplicationPhases = new List<JobApplicationPhase>();

    //filtered output
    List<Application> CurrentApplications;
    List<JobApplicationPhase> JobPhases;
    Job CurrentJob;

    //list for draggable items
    List<ApplicationPhaseItem> Items = new List<ApplicationPhaseItem>();
    List<ApplicationPhaseItem> FilteredItems => Items.Where(item => item.Name.ToLower().Contains(searchTerm.ToLower()) || item.Surname.ToLower().Contains(searchTerm.ToLower())).ToList();



    //dialogs
    bool ScreeningDialogIsOpen = false;
    bool AssessmentDialogIsOpen = false;
    bool InterviewDialogIsOpen = false;
    bool ReferenceCheckDialogIsOpen = false;
    bool OfferDialogIsOpen = false;
    bool HiredDialogIsOpen = false;
    bool ReasonDialogIsOpen = false;

    //css borders
    string AppliedDropClass = "";
    string ScreeningDropClass = "";
    string AssessmentDropClass = "";
    string InterviewDropClass = "";
    string ReferenceDropClass = "";
    string OfferDropClass = "";
    string SuccessDropClass = "";

    //dialog phases
    string ScreeningOne = "";
    string ScreeningTwo = "";
    string ScreeningThree = "";

    string InterviewOne = "";
    string InterviewTwo = "";
    string InterviewThree = "";
    string InterviewFour = "";
    string InterviewFive = "";

    string OfferOne = "";
    string OfferTwo = "";
    string OfferThree = "";

    string Hired = "";
    string NotHired = "";



    protected override async Task OnParametersSetAsync()
    {
        if(AllJobs.Exists(x => x.Id == CurrentJobId))
        {
            CurrentApplications = AllApplications.Where(x => x.JobId == CurrentJobId).ToList();
            JobPhases = AllJobApplicationPhases.Where(x => x.JobId == CurrentJobId).ToList();
            CurrentJob = AllJobs.SingleOrDefault(x => x.Id == CurrentJobId);

            CurrentJobTitle = CurrentJob.Title;

            TotalPhases.Clear();
            TotalPhases.Add(1);
            TotalPhases.Add(13);
            TotalPhases.Add(36);

            foreach (var phase in JobPhases)
            {
                TotalPhases.Add(phase.ApplicationPhaseId);
            }

            if (JobPhases.Exists((x) => x.ApplicationPhaseId is 3 or 5 or 25))
            {
                TotalPhases.Add(10);
            }
            if (JobPhases.Exists((x) => x.ApplicationPhaseId is 26 or 28 or 29 or 30 or 31))
            {
                TotalPhases.Add(11);
            }
            if (JobPhases.Exists((x) => x.ApplicationPhaseId is 33 or 34 or 35))
            {
                TotalPhases.Add(12);
            }

            Items.Clear();
            FilteredItems.Clear();

            foreach (var application in CurrentApplications)
            {
                ApplicationPhaseItem temp = new ApplicationPhaseItem();
                temp.Id = application.Id;
                temp.ApplicationId = application.Id;
                temp.Name = tempAppUsers.First((x) => x.id == application.AppUserId).name;
                temp.Surname = tempAppUsers.First((x) => x.id == application.AppUserId).surname;
                temp.Email = tempAppUsers.First((x) => x.id == application.AppUserId).email;
                temp.Picture = tempAppUsers.First((x) => x.id == application.AppUserId).imageUrl;

                temp.ApplicationPhaseId = CurrentApplications.First((x) => x.Id == temp.ApplicationId).ApplicationPhaseId;

                Items.Add(temp);
            }
        }

    }

    protected override async Task OnInitializedAsync()
    {
        AllJobs = await httpClient.GetFromJsonAsync<List<Job>>("https://xebecapi.azurewebsites.net/api/job");
        AllApplications = await httpClient.GetFromJsonAsync<List<Application>>("https://xebecapi.azurewebsites.net/api/application");
        AllJobApplicationPhases = await httpClient.GetFromJsonAsync<List<JobApplicationPhase>>("https://xebecapi.azurewebsites.net/api/jobapplicationphase");

        tempAppUsers = await httpClient.GetFromJsonAsync<List<AppUser>>("https://xebecapi.azurewebsites.net/api/user");
        CurrentApplicantPhases = await httpClient.GetFromJsonAsync<List<ApplicationPhasesHelper>>("https://xebecapi.azurewebsites.net/api/applicationphasehelper");
        AppPhases = await httpClient.GetFromJsonAsync<List<ApplicationPhase>>("https://xebecapi.azurewebsites.net/api/applicationphase");
        Unsuccessful = await httpClient.GetFromJsonAsync<List<UnsuccessfulReason>>("https://xebecapi.azurewebsites.net/api/unsuccessfulreason");
        RejectedUsers = await httpClient.GetFromJsonAsync<List<RejectedCandidate>>("https://xebecapi.azurewebsites.net/api/rejectedcandidate");
    }




    private void HandleDragEnter(int applicationPhase)
    {
        if (applicationPhase == CurrentItem.ApplicationPhaseId) return;

        AppliedDropClass = "can-drop";
        SuccessDropClass = "can-drop";

        ScreeningDropClass = "no-drop";
        AssessmentDropClass = "no-drop";
        InterviewDropClass = "no-drop";
        ReferenceDropClass = "no-drop";
        OfferDropClass = "no-drop";


        if (TotalPhases.Contains(3) || TotalPhases.Contains(5) || TotalPhases.Contains(25))
        {
            ScreeningDropClass = "can-drop";
        }
        if (TotalPhases.Contains(27))
        {
            AssessmentDropClass = "can-drop";
        }
        if (TotalPhases.Contains(26) || TotalPhases.Contains(28) || TotalPhases.Contains(29) || TotalPhases.Contains(30) || TotalPhases.Contains(31))
        {
            InterviewDropClass = "can-drop";
        }
        if (TotalPhases.Contains(32))
        {
            ReferenceDropClass = "can-drop";
        }
        if (TotalPhases.Contains(33) || TotalPhases.Contains(34) || TotalPhases.Contains(35))
        {
            OfferDropClass = "can-drop";
        }

    }

    private void HandleDragLeave()
    {
        AppliedDropClass = "";
        ScreeningDropClass = "";
        AssessmentDropClass = "";
        InterviewDropClass = "";
        ReferenceDropClass = "";
        OfferDropClass = "";
        SuccessDropClass = "";
    }

    private async Task HandleDrop(int phase)
    {
        AppliedDropClass = "";
        ScreeningDropClass = "";
        AssessmentDropClass = "";
        InterviewDropClass = "";
        ReferenceDropClass = "";
        OfferDropClass = "";
        SuccessDropClass = "";

        CurrentEmailTemplate = "";

        if (!TotalPhases.Contains(phase)) return;


        if (phase == CurrentItem.ApplicationPhaseId) return;

        if (phase == 10)
        {
            if (CurrentItem.ApplicationPhaseId is 3 or 5 or 25 or 10) return;
        }
        if (phase == 11)
        {
            if (CurrentItem.ApplicationPhaseId is 26 or 28 or 29 or 30 or 31 or 11) return;
        }
        if (phase == 12)
        {
            if (CurrentItem.ApplicationPhaseId is 33 or 34 or 35 or 12) return;
        }
        if (phase is 36 or 13)
        {
            if (CurrentItem.ApplicationPhaseId is 36 or 13) return;
        }

        await UpdateJobAsync(phase);

    }

    private void HandleDragStart(ApplicationPhaseItem selectedItem)
    {
        CurrentItem = selectedItem;
        CurrentEmailRecipient = CurrentItem.Email;
    }

    public async Task UpdateJobAsync(int phase)
    {
        CurrentItem.ApplicationPhaseId = phase;

        var task = Items.SingleOrDefault(x => x.Id == CurrentItem.Id);

        if (phase is 10 or 11 or 12 or 13 && task != null)
        {
            task.ApplicationPhaseId = phase;
            return;
        }

        if (task != null)
        {
            task.ApplicationPhaseId = phase;

            Application temp = new Application();

            temp = CurrentApplications.Single(i => i.Id == CurrentItem.ApplicationId);
            temp.ApplicationPhaseId = phase;

            await httpClient.PutAsJsonAsync<Application>($"https://xebecapi.azurewebsites.net/api/application/{CurrentItem.ApplicationId}", temp);

            ApplicationPhasesHelper tempHelper = new ApplicationPhasesHelper();
            tempHelper.ApplicationId = CurrentItem.ApplicationId;
            tempHelper.ApplicationPhaseId = phase;
            tempHelper.TimeMoved = DateTime.Now;

            await httpClient.PostAsJsonAsync<ApplicationPhasesHelper>("https://xebecapi.azurewebsites.net/api/applicationphasehelper", tempHelper);
        }
    }

    public void ShowDialog(ApplicationPhaseItem item)
    {
        CurrentItem = item;
        CurrentEmailRecipient = CurrentItem.Email;

        ScreeningOne = "";
        ScreeningTwo = "";
        ScreeningThree = "";

        InterviewOne = "";
        InterviewTwo = "";
        InterviewThree = "";
        InterviewFour = "";
        InterviewFive = "";

        OfferOne = "";
        OfferTwo = "";
        OfferThree = "";

        Hired = "";
        NotHired = "";


        if (item.ApplicationPhaseId is 3 or 5 or 25 or 10)
        {
            ScreeningDialogIsOpen = true;

            if (item.ApplicationPhaseId == 3)
            {
                ScreeningOne = "currentphase";
                CurrentEmailTemplate = ConvertEmail(AppPhases.First(x => x.id == 3).EmailTemplate);
            }
            else if (item.ApplicationPhaseId == 5)
            {
                ScreeningTwo = "currentphase";
                CurrentEmailTemplate = ConvertEmail(AppPhases.First(x => x.id == 5).EmailTemplate);
            }
            else if (item.ApplicationPhaseId == 25)
            {
                ScreeningThree = "currentphase";
                CurrentEmailTemplate = ConvertEmail(AppPhases.First(x => x.id == 25).EmailTemplate);
            }

            if (!TotalPhases.Contains(3))
            {
                ScreeningOne = "disabled-card";
            }
            if (!TotalPhases.Contains(5))
            {
                ScreeningTwo = "disabled-card";
            }
            if (!TotalPhases.Contains(25))
            {
                ScreeningThree = "disabled-card";
            }
        }

        else if (item.ApplicationPhaseId == 27)
        {
            AssessmentDialogIsOpen = true;
            CurrentEmailTemplate = AppPhases.First(x => x.id == 27).EmailTemplate;
        }

        else if (item.ApplicationPhaseId is 26 or 28 or 29 or 30 or 31 or 11)
        {
            InterviewDialogIsOpen = true;

            if (item.ApplicationPhaseId == 26)
            {
                InterviewOne = "currentphase";
                CurrentEmailTemplate = ConvertEmail(AppPhases.First(x => x.id == 26).EmailTemplate);
            }
            else if (item.ApplicationPhaseId == 28)
            {
                InterviewTwo = "currentphase";
                CurrentEmailTemplate = ConvertEmail(AppPhases.First(x => x.id == 28).EmailTemplate);
            }
            else if (item.ApplicationPhaseId == 29)
            {
                InterviewThree = "currentphase";
                CurrentEmailTemplate = ConvertEmail(AppPhases.First(x => x.id == 29).EmailTemplate);
            }
            else if (item.ApplicationPhaseId == 30)
            {
                InterviewFour = "currentphase";
                CurrentEmailTemplate = ConvertEmail(AppPhases.First(x => x.id == 30).EmailTemplate);
            }
            else if (item.ApplicationPhaseId == 31)
            {
                InterviewFive = "currentphase";
                CurrentEmailTemplate = ConvertEmail(AppPhases.First(x => x.id == 31).EmailTemplate);
            }
            if (!TotalPhases.Contains(26))
            {
                InterviewOne = "disabled-card";
            }
            if (!TotalPhases.Contains(28))
            {
                InterviewTwo = "disabled-card";
            }
            if (!TotalPhases.Contains(29))
            {
                InterviewThree = "disabled-card";
            }
            if (!TotalPhases.Contains(39))
            {
                InterviewFour = "disabled-card";
            }
            if (!TotalPhases.Contains(31))
            {
                InterviewFive = "disabled-card";
            }
        }

        else if (item.ApplicationPhaseId == 32)
        {
            ReferenceCheckDialogIsOpen = true;
            CurrentEmailTemplate = ConvertEmail(AppPhases.First(x => x.id == 32).EmailTemplate);
        }

        else if (item.ApplicationPhaseId is 33 or 34 or 35 or 12)
        {
            OfferDialogIsOpen = true;

            if (item.ApplicationPhaseId == 33)
            {
                OfferOne = "currentphase";
                CurrentEmailTemplate = ConvertEmail(AppPhases.First(x => x.id == 33).EmailTemplate);
            }
            else if (item.ApplicationPhaseId == 34)
            {
                OfferTwo = "currentphase";
                CurrentEmailTemplate = ConvertEmail(AppPhases.First(x => x.id == 34).EmailTemplate);
            }
            else if (item.ApplicationPhaseId == 35)
            {
                OfferThree = "currentphase";
                CurrentEmailTemplate = ConvertEmail(AppPhases.First(x => x.id == 35).EmailTemplate);
            }
            if (!TotalPhases.Contains(33))
            {
                OfferOne = "disabled-card";
            }
            if (!TotalPhases.Contains(34))
            {
                OfferTwo = "disabled-card";
            }
            if (!TotalPhases.Contains(35))
            {
                OfferThree = "disabled-card";
            }
        }

        else if (item.ApplicationPhaseId is 36 or 13)
        {
            HiredDialogIsOpen = true;

            if (item.ApplicationPhaseId == 36)
            {
                if (RejectedUsers.Exists(x => x.ApplicationId == CurrentItem.ApplicationId))
                {
                    NotHired = "currentphase";
                }
                else
                {
                    Hired = "currentphase";
                    CurrentEmailTemplate = ConvertEmail(AppPhases.First(x => x.id == 36).EmailTemplate);
                }
            }
        }

    }

    public async Task MovePhase(int i)
    {
        if (!TotalPhases.Contains(i)) return;

        var task = Items.SingleOrDefault(x => x.Id == CurrentItem.Id);

        CurrentItem.ApplicationPhaseId = i;

        if (task != null)
        {
            Application temp = new Application();

            temp = CurrentApplications.Single(i => i.Id == CurrentItem.ApplicationId);
            temp.ApplicationPhaseId = i;

            await httpClient.PutAsJsonAsync<Application>($"https://xebecapi.azurewebsites.net/api/application/{CurrentItem.ApplicationId}", temp);
        }

        ApplicationPhasesHelper tempHelper = new ApplicationPhasesHelper();
        tempHelper.ApplicationId = CurrentItem.ApplicationId;
        tempHelper.ApplicationPhaseId = i;
        tempHelper.TimeMoved = DateTime.Now;

        await httpClient.PostAsJsonAsync<ApplicationPhasesHelper>("https://xebecapi.azurewebsites.net/api/applicationphasehelper", tempHelper);

        ScreeningOne = "";
        ScreeningTwo = "";
        ScreeningThree = "";

        InterviewOne = "";
        InterviewTwo = "";
        InterviewThree = "";
        InterviewFour = "";
        InterviewFive = "";

        OfferOne = "";
        OfferTwo = "";
        OfferThree = "";

        Hired = "";
        NotHired = "";

        if (!TotalPhases.Contains(3))
        {
            ScreeningOne = "disabled-card";
        }
        if (!TotalPhases.Contains(5))
        {
            ScreeningTwo = "disabled-card";
        }
        if (!TotalPhases.Contains(25))
        {
            ScreeningThree = "disabled-card";
        }
        if (!TotalPhases.Contains(26))
        {
            InterviewOne = "disabled-card";
        }
        if (!TotalPhases.Contains(28))
        {
            InterviewTwo = "disabled-card";
        }
        if (!TotalPhases.Contains(29))
        {
            InterviewThree = "disabled-card";
        }
        if (!TotalPhases.Contains(39))
        {
            InterviewFour = "disabled-card";
        }
        if (!TotalPhases.Contains(31))
        {
            InterviewFive = "disabled-card";
        }
        if (!TotalPhases.Contains(33))
        {
            OfferOne = "disabled-card";
        }
        if (!TotalPhases.Contains(34))
        {
            OfferTwo = "disabled-card";
        }
        if (!TotalPhases.Contains(35))
        {
            OfferThree = "disabled-card";
        }


        if (i == 3)
        {
            ScreeningOne = "currentphase";
            CurrentEmailTemplate = ConvertEmail(AppPhases.First(x => x.id == 3).EmailTemplate);
        }
        else if (i == 5)
        {
            ScreeningTwo = "currentphase";
            CurrentEmailTemplate = ConvertEmail(AppPhases.First(x => x.id == 5).EmailTemplate);
        }
        else if (i == 25)
        {
            ScreeningThree = "currentphase";
            CurrentEmailTemplate = ConvertEmail(AppPhases.First(x => x.id == 25).EmailTemplate);
        }
        else if (i == 26)
        {
            InterviewOne = "currentphase";
            CurrentEmailTemplate = ConvertEmail(AppPhases.First(x => x.id == 26).EmailTemplate);
        }
        else if (i == 28)
        {
            InterviewTwo = "currentphase";
            CurrentEmailTemplate = ConvertEmail(AppPhases.First(x => x.id == 28).EmailTemplate);
        }
        else if (i == 29)
        {
            InterviewThree = "currentphase";
            CurrentEmailTemplate = ConvertEmail(AppPhases.First(x => x.id == 29).EmailTemplate);
        }
        else if (i == 30)
        {
            InterviewFour = "currentphase";
            CurrentEmailTemplate = ConvertEmail(AppPhases.First(x => x.id == 30).EmailTemplate);
        }
        else if (i == 31)
        {
            InterviewFive = "currentphase";
            CurrentEmailTemplate = ConvertEmail(AppPhases.First(x => x.id == 31).EmailTemplate);
        }
        else if (i == 33)
        {
            OfferOne = "currentphase";
            CurrentEmailTemplate = ConvertEmail(AppPhases.First(x => x.id == 32).EmailTemplate);
        }
        else if (i == 34)
        {
            OfferTwo = "currentphase";
            CurrentEmailTemplate = ConvertEmail(AppPhases.First(x => x.id == 33).EmailTemplate);
        }
        else if (i == 35)
        {
            OfferThree = "currentphase";
            CurrentEmailTemplate = ConvertEmail(AppPhases.First(x => x.id == 34).EmailTemplate);
        }
        else if (i == 36)
        {
            if (RejectedUsers.Exists(x => x.ApplicationId == CurrentItem.ApplicationId))
            {
                NotHired = "currentphase";
            }
            else
            {
                Hired = "currentphase";
                CurrentEmailTemplate = ConvertEmail(AppPhases.First(x => x.id == 36).EmailTemplate);
            }
        }

    }

    public async Task Deny()
    {
        tempReasonId = -1;

        ReasonDialogIsOpen = true;
    }

    public async Task Reject()
    {
        if (tempReasonId != -1)
        {
            RejectedCandidate temp = new RejectedCandidate();

            temp.ApplicationId = CurrentItem.ApplicationId;
            temp.UnsuccessfulReasonId = tempReasonId;

            await httpClient.PostAsJsonAsync<RejectedCandidate>("https://xebecapi.azurewebsites.net/api/rejectedcandidate", temp);
            RejectedUsers = await httpClient.GetFromJsonAsync<List<RejectedCandidate>>("https://xebecapi.azurewebsites.net/api/rejectedcandidate");

            MovePhase(36);
        }

        ReasonDialogIsOpen = false;
    }

    public string ConvertEmail(string email)
    {
        email = email.Replace("{firstname}", CurrentItem.Name);
        email = email.Replace("{surname}", CurrentItem.Surname);

        email = email.Replace("{date}", DateTime.Now.Date.ToString());
        email = email.Replace("{time}", DateTime.Now.TimeOfDay.ToString());

        //email.Replace("{sentname}", CurrentItem.Name);
        //email.Replace("{sentsurname}", CurrentItem.Name);
        //email.Replace("{senttitle}", CurrentItem.Name);

        return email;
    }

    public void SendEmail()
    {

    }
}
