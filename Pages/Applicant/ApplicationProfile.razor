@page "/applicationprofile"
@inject HttpClient httpClient
@inject IJSRuntime jsRuntime
@inject ISnackbar Snackbar

<style>
    .nav1 {
        width: auto !important;
        height: auto !important;
        top: auto !important;
        justify-content: normal !important;
        justify-items: normal !important;
        box-shadow: rgba(6, 24, 44, 0.4) 0px 0px 0px 2px, rgba(6, 24, 44, 0.65) 0px 4px 6px -1px, rgba(255, 255, 255, 0.08) 0px 1px 0px inset;
        border-radius: 5px;
    }

    .nav-link1 {
        width: auto !important;
        height: auto !important;
        margin-bottom: auto !important;
        display: normal !important;
        vertical-align: auto !important;
        border-radius: 0px;
        background-color: white;
        color: #00bcae;
        cursor: pointer;
    }

    .nav-link-text1 {
        display: normal !important;
        padding-top: 0px;
        width: auto !important;
        height: auto !important;
    }

    select {
        font-size: medium !important
    }

    .formButton {
        background-color: #00BCAE;
        color: white;
        font-weight: 600;
        height: 5vh;
        margin-top: 2vh;
        width: auto;
    }

    .drag-drop-zone {
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all .4s;
        height: 140px;
    }

    .drag-drop-input {
        position: absolute;
        width: 690px;
        height: 140px;
        opacity: 0;
        cursor: pointer;
        z-index: 2;
        border: unset;
    }
    .drop-corner{
        border: #00BCAE dashed 2px !important;
        box-shadow: unset;
    }
    .drag-enter {
        box-shadow: var(--mud-elevation-10);
    }

    .list {
        padding: 2em;
        min-width: 100%;
    }

    .card:hover {
        border: 4px solid #d0d0d0;
        background: #e1e1e1;
        box-shadow: 0 0 0 4px #d0d0d0;
    }

    .cardBorderChange {
        border: 4px solid #00BCAE;
        background: #00BCAE;
        box-shadow: 0 0 0 4px #00BCAE;
    }

    .cardBorderChange:hover {
        border: 4px solid #00BCAE;
        background: #00BCAE;
        box-shadow: 0 0 0 4px #00BCAE;
    }
    .form-check-label:hover{
        cursor: pointer;
    }
    .form-check-input{
        display: none;
    }

    .row-style{
        background: linear-gradient(110deg, rgba(0,51,64,0.56) 40%, rgba(0,188,174,0.53) 40%, #00BCAE);
        /*background-color: white;*/
        border-radius: 20px;
        padding: 10px;
        min-height: 75vh;
    }
    .rounded-edges{
        border-radius: 20px;
        box-shadow: rgba(0, 0, 0, 0.05) 0px 0px 0px 1px, rgb(209, 213, 219) 0px 0px 0px 1px inset;
    }
  .nav-item > .active{
        background: #ffffff !important;
        font-weight: 800;
        font-size: 2vh;
    }
    .nav-item > .nav-link1{
        font-size: 1.8vh;
        font-weight: 500 !important;
        color: #003340!important;
    }
    .work-card{
        color: black!important;
    }
    .white-back{
        background: white !important;
        box-shadow: rgb(38, 57, 77) 0px 20px 30px -10px !important;
    }
    .text-color-primary{
        color: rgba(0,51,64,0.76);
        text-decoration: underline;
    }
</style>

<div class="h-100 container-fluid d-flex justify-content-center align-items-center">

<div class="row col-10 d-flex justify-content-center row-style">

<!--Navigation Tab-->
<div class="col-12 align-self-start d-flex justify-content-center align-items-center">
    <ul class="nav nav1 nav-tabs" role="tablist">
        <li class="nav-item p-1">
            <a id="personal-tab" class="nav-link nav-link1 active" data-bs-toggle="tab" href="#personal-information">Personal Information</a>
        </li>
        <li class="nav-item p-1">
            <a class="nav-link nav-link1" data-bs-toggle="tab" href="#work-history">Work History</a>
        </li>
        <li class="nav-item p-1">
            <a class="nav-link nav-link1" data-bs-toggle="tab" href="#education">Education</a>
        </li>
        <li class="nav-item p-1">
            <a id="online-tag" class="nav-link nav-link1" data-bs-toggle="tab" href="#online-profile">Online Profile</a>
        </li>
    </ul>
</div>

<!--Content Panel-->
<div class="col-12 d-flex justify-content-center align-items-start pt-3 ">
<div class="tab-content ">
<br/>
<!--Personal Information-->
<div id="personal-information" class="container tab-pane active">
    <div class="d-flex justify-content-center">
        <form id="personal-information-form" style="width: 60%">
            <div class="row">
                <div class="col-12 shadow-sm bg-body rounded-edges white-back" >
                    <div class="row p-3">
                        <div class="col-12">
                            <div class="rounded-edges">
                                <MudPaper @ondragenter="@(() => _dragEnterStyle = "drag-enter")"
                                          @ondragleave="@(() => _dragEnterStyle = null)"
                                          @ondragend="@(() => _dragEnterStyle = null)"
                                          Class="@("drag-drop-zone rounded-edges drop-corner " + _dragEnterStyle)">

                                    <InputFile OnChange="OnInputFileChanged" multiple class="drag-drop-input"/>
                                    @if (fileNames.Count() == 0)
                                    {
                                        <MudText Typo="Typo.h3" Align="Align.Center">
                                            <i class="fa fa-upload"></i>
                                            <br/>
                                            Upload File
                                        </MudText>
                                    }
                                    else
                                    {
                                        <MudList Style="padding:2em;width:100%;" Dense="true">
                                            @foreach (var file in fileNames)
                                            {
                                                <MudListItem @key="@file">
                                                    <MudChip Color="Color.Dark"
                                                             Style="width:60px; overflow:hidden;"
                                                             Text="@(file.Split(".").Last())"/>
                                                    @file
                                                </MudListItem>
                                            }
                                        </MudList>
                                    }
                                </MudPaper>
                            </div>
                            <br/>
                            <MudGrid Justify="Justify.Center" Spacing="4">
                                <MudItem>
                                    <MudButton OnClick="Upload" Disabled="@(!fileNames.Any())" Style="color: white; background-color: #00BCAE; font-size: small" Variant="Variant.Filled">Upload</MudButton>
                                </MudItem>
                                <MudItem>
                                    <MudButton OnClick="@fileNames.Clear" Disabled="@(!fileNames.Any())" Style="color: white; background-color: #00BCAE; font-size: small" Variant="Variant.Filled">Clear</MudButton>
                                </MudItem>
                            </MudGrid>
                        </div>
                    </div>
                    <div class="row p-3">
                        <div class="col-4">
                            <label class="form-label" for="first-name">First Name</label>
                            <input id="first-name" class="form-control shadow bg-body rounded" type="text" @bind="personalInformation.FirstName" placeholder="John" required/>
                        </div>
                        <div class="col-4">
                            <label class="form-label" for="last-name">Last Name</label>
                            <input id="last-name" class="form-control shadow bg-body rounded" type="text" @bind="personalInformation.LastName" placeholder="Smith" required/>
                        </div>
                        <div class="col-4">
                            <label class="form-label" for="email-address">Email Address</label>
                            <input id="email-address" class="form-control shadow bg-body rounded" type="email" @bind="personalInformation.Email" placeholder="John@gmail.com" required/>
                        </div>
                    </div>
                    <div class="row p-3">
                        <div class="col-4">
                            <label class="form-label" for="phone-number">Phone Number</label>
                            <input id="phone-number" class="form-control shadow bg-body rounded" type="tel" @bind="personalInformation.PhoneNumber" placeholder="0713369875" required/>
                        </div>
                        <div class="col-4">
                            <label class="form-label" for="ethnicity">Ethnicity</label>
                            <select id="ethnicity" class="form-select shadow bg-body rounded" @bind="additionalInformation.Ethnicity" required>
                                <option value="" disabled selected>Select Ethnicity</option>
                                <option value="African">African</option>
                                <option value="White">White</option>
                            </select>
                        </div>
                        <div class="col-4">
                            <label class="form-label" for="gender">Gender</label>
                            <select id="gender" class="form-select shadow bg-body rounded" @bind="additionalInformation.Gender" required>
                                <option value="" disabled selected>Select Gender</option>
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                            </select>
                        </div>
                    </div>
                    <div class="row p-3">
                        <div class="col-4">
                            <label class="form-label" for="id-number">ID Number</label>
                            <input id="id-number" class="form-control shadow bg-body rounded" type="text" min="13" max="13" @bind="personalInformation.IdNumber" placeholder="010205365987" required/>
                        </div>
                        <div class="col-8">
                            <label class="form-label" for="address">Address</label>
                            <textarea id="address" class="form-control shadow bg-body rounded" @bind="personalInformation.Address" placeholder="Address" rows="4" required></textarea>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>

<!--Work History-->
<div id="work-history" class="container tab-pane">
    <form id="work-history-form">
        <div class="row">
            <div class="col-12">
                <div class="row p-3">
                    <div class="col-6 p-5">
                        <div class="row shadow-sm bg-body rounded-edges white-back" style="height: 47vh;">
                            <div class="col-12" style="height: 365px">
                                <input type="hidden" @bind="workHistory.Id"/>
                                <input type="hidden" @bind="workHistory.AppUserId"/>
                                <div class="row p-3">
                                    <div class="col-6">
                                        <label class="form-label" for="company-name">Company Name</label>
                                        <input id="company-name" class="form-control shadow bg-body rounded" type="text" @bind="workHistory.CompanyName" placeholder="1Nebula" required/>
                                    </div>
                                    <div class="col-6">
                                        <label class="form-label" for="job-title">Job Title</label>
                                        <input id="job-title" class="form-control shadow bg-body rounded" type="text" @bind="workHistory.JobTitle" placeholder="Software Developer" required/>
                                    </div>
                                </div>
                                <div class="row p-3">
                                    <div class="col-6">
                                        <label class="form-label" for="start-date">Start Date</label>
                                        <input id="start-date" class="form-control shadow bg-body rounded" @bind="workHistory.StartDate" @onblur="StartDateCheck" type="date" required/>
                                    </div>
                                    @if (presentWork)
                                    {
                                        <div class="col-6">

                                            <label class="form-label" for="end-date">
                                                End Date (
                                                <span>
                                                    <label class="form-check-label text-color-primary" for="flexCheckDefault">
                                                        Still work there?
                                                    </label>
                                                    <input class="form-check-input" type="checkbox" value="" id="flexCheckDefault" @bind="@presentWork">
                                                </span>)
                                            </label>
                                            <input id="end-date" class="form-control shadow bg-body rounded" @bind="workHistory.EndDate" @onblur="EndDateCheck" type="date"/>
                                        </div>
                                    }
                                    else
                                    {
                                        <div class="col-6">
                                            <div class="form-check">
                                                <label class="form-check-label text-color-primary" for="flexCheckDefault">
                                                    Don't work there anymore?
                                                </label>
                                                <input class="form-check-input" type="checkbox" value="" id="flexCheckDefault" @bind="@presentWork">
                                            </div>
                                        </div>
                                    }
                                </div>
                                <div class="row p-3">
                                    <div class="col-12">
                                        <label class="form-label" for="description">Description</label>
                                        <textarea id="description" class="form-control shadow bg-body rounded" placeholder="Description" @bind="workHistory.Description" rows="4"></textarea>
                                    </div>
                                    <div class="col-12 d-flex justify-content-around">
                                        @if (workHistUpdate)
                                        {
                                            <input class="btn formButton" type="button" @onclick="() => UpdateWorkHistory(workHistory)" value="Update"/>
                                        }
                                        else
                                        {
                                            <input class="btn formButton" type="button" @onclick="() => AddWorkHistoryNew(workHistory)" value="Add"/>
                                        }
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-6 p-5 align-self-start">
                        <div class="row shadow-sm bg-body rounded-edges" style="background-color: white; height: 47vh;">
                            <div class="col-12 overflow-auto" style="height: 365px">
                                <br/>
                                @if (workHistoryList != null && workHistoryList.Count > 0)
                                {
                                    foreach (var item in workHistoryList)
                                    {
                                        <div class="work-card">
                                            <div class="company-name">@workHistory.CompanyName</div>
                                            <div class="job-position">@workHistory.JobTitle</div>
                                            <div class="start-end-date">
                                                <small>@($"{workHistory.StartDate:yyyy MMMM} - {workHistory.EndDate:yyyy MMMM}")</small>

                                                <span @onclick="() => DeleteWorkHistory(item.Id)">
                                                    <i class="fa fa-times-circle fa-2x" style="color: red"></i>
                                                </span>
                                            </div>
                                            <div class="work-description">@workHistory.Description</div>
                                        </div>
                                    }
                                }
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>

<!--Education-->
<div id="education" class="container tab-pane">
    <form id="education-form">
        <div class="row">
            <div class="col-12">
                <div class="row p-3">
                    <div class="col-6 p-5">
                        <div class="row shadow-sm bg-body rounded-edges white-back">
                            <div class="col-12" style="height: 45vh">
                                <input type="hidden" @bind="education.Id"/>
                                <input type="hidden" @bind="education.AppUserId"/>
                                <div class="row p-3">
                                    <div class="col-6">
                                        <label class="form-label" for="institution">Institution</label>
                                        <input id="institution" class="form-control shadow bg-body rounded" type="text" @bind="education.Insitution" placeholder="University of Cape Town" required/>
                                    </div>
                                    <div class="col-6">
                                        <label class="form-label" for="qualification">Qualification</label>
                                        <input id="qualification" class="form-control shadow bg-body rounded" type="text" @bind="education.Qualification" placeholder="BSc Chemical Engineering" required/>
                                    </div>
                                </div>
                                <div class="row p-3">
                                    <div class="col-6">
                                        <label class="form-label" for="start-date">Start Date</label>
                                        <input id="start-date" class="form-control shadow bg-body rounded" @bind="education.StartDate" @onblur="StartDateCheck" type="date" required/>
                                    </div>
                                    @if (presentSchool)
                                    {
                                        <div class="col-6">

                                            <label class="form-label" for="end-date">
                                                End Date (
                                                <span>
                                                    <label class="form-check-label text-color-primary" for="edu-check">
                                                        Completed?
                                                    </label>
                                                    <input class="form-check-input" type="checkbox"  id="edu-check" @bind="@presentSchool">
                                                </span>)
                                            </label>
                                            <input id="end-date" class="form-control shadow bg-body rounded" @bind="education.EndDate" @onblur="EndDateCheck" type="date"/>
                                        </div>
                                    }
                                    else
                                    {
                                        <div class="col-6">
                                            <div class="form-check">
                                                <label class="form-check-label text-color-primary" for="edu-check">
                                                    Not Completed
                                                </label>
                                                <input class="form-check-input" type="checkbox"  id="edu-check" @bind="@presentSchool">
                                            </div>
                                        </div>
                                    }
                                </div>
                                <div class="row p-3">
                                    <div class="col-12 d-flex justify-content-around">
                                        @if (eduUpdate)
                                        {
                                            <input class="btn formButton" type="button" @onclick="() => UpdateEducation(education)" value="Update"/>
                                        }
                                        else
                                        {
                                            <input class="btn formButton" type="button" @onclick="() => AddEducation(education)" value="Add"/>
                                        }
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-6 p-5">
                        <div class="row shadow-sm bg-body rounded-edges white-back">
                            <div class="col-12 overflow-auto" style="height: 47vh">
                                <br/>
                                @if (educationList != null && educationList.Count > 0)
                                {
                                    foreach (var item in educationList)
                                    {
                                        <div class="work-card mb-3">
                                            <div class="company-name">@education.Qualification</div>
                                            <div class="job-position"></div>
                                            <div class="start-end-date">
                                                <small>@($"{education.StartDate:yyyy MMMM} - {education.EndDate:yyyy MMMM}")</small>
                                                <span @onclick="() => DeleteEducation(item.Id)">
                                                    <i class="fa fa-times-circle fa-2x" style="color: red"></i>
                                                </span>
                                            </div>
                                            <div class="work-description">@education.Insitution</div>
                                        </div>
                                    }
                                }
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>

<!--Online Profile-->
<div id="online-profile" class="container tab-pane" style="height: 60vh;">
    <form class="col-12 d-flex justify-content-center align-items-start">
        <div class="row col-9">
            <div class="col-12 shadow-sm bg-body rounded-edges align-self-start white-back">
                <div class="row p-3">
                    <div class="col-6">
                        <div>
                            <label class="form-label" for="github">Github</label>
                            &ensp;
                            <i class="fab fa-github fa-2x"></i>
                        </div>
                        <input id="github" class="form-control shadow bg-body rounded" type="text" @bind="profilePortfolio.GitHubLink"/>
                    </div>
                    <div class="col-6">
                        <div>
                            <label class="form-label" for="linkedin">LinkedIn</label>
                            &ensp;
                            <i class="fab fa-linkedin-in fa-2x" style="color: #0077b5"></i>
                        </div>
                        <input id="linkedin" class="form-control shadow bg-body rounded" type="text" @bind="profilePortfolio.LinkedInLink"/>
                    </div>
                </div>
                <div class="row p-3">
                    <div class="col-6">
                        <div>
                            <label class="form-label" for="twitter">Twitter</label>
                            &ensp;
                            <i class="fab fa-twitter-square fa-2x" style="color: #00acee"></i>
                        </div>
                        <input id="twitter" class="form-control shadow bg-body rounded" type="text" @bind="profilePortfolio.TwitterLink"/>
                    </div>
                    <div class="col-6">
                        <div>
                            <label class="form-label" for="personal-website">Personal Website</label>
                            &ensp;
                            <i class="fas fa-globe fa-2x" style="color: #35afc0"></i>
                        </div>
                        <input id="personal-website" class="form-control shadow bg-body rounded" type="text" @bind="profilePortfolio.PersonalWebsiteUrl"/>
                    </div>
                </div>
                <div class="row p-3">
                    <div class="col-12 d-flex justify-content-center">
                        <input class="btn formButton" type="button" value="Done" @onclick="Submit"/>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>
</div>
</div>
</div>
</div>

@code {
    private bool presentWork = false;
    private bool presentSchool = false;
    private int id = 1;
    private void AddWorkHistoryNew(WorkHistory workHistory1)
    {
        workHistory.Id = id++;
        if (!workHistoryList.Contains(workHistory) || !FindWork(workHistory1))
            workHistoryList.Add(workHistory);
        else
            jsRuntime.InvokeVoidAsync("alert", "Job Added");
    }

    private bool FindWork(WorkHistory workHistory1)
    {
        var temp = workHistoryList.FirstOrDefault(w => w.Id == workHistory1.Id || w.CompanyName.ToLower().Equals(workHistory1.CompanyName.ToLower()));
        return temp == null;
    }

}